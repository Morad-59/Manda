/*! Copyright (c) 2020 Mediarithmics; All Rights Reserved */

"use strict";function evalOperator(e,a){if(!e)return!1;if(Array.isArray(e))return e.some(e=>evalOperator(e,a));switch(a.type){case"NUMERIC":switch(a.operator){case"EQUAL":return a.values&&e===parseInt(a.values[0]);case"NOT_EQUAL":return a.values&&e!==parseInt(a.values[0]);case"LT":return a.values&&e<parseInt(a.values[0]);case"LTE":return a.values&&e<=parseInt(a.values[0]);case"GT":return a.values&&e>parseInt(a.values[0]);case"GTE":return a.values&&e>=parseInt(a.values[0]);default:return!1}case"ENUM":switch(a.operator){case"EQUAL":return a.values&&e===a.values[0];case"NOT_EQUAL":return a.values&&e!==a.values[0];default:return!1}case"STRING":switch(a.operator){case"EQ":return a.values&&e===a.values[0];case"NOT_EQ":return a.values&&e!==a.values[0]}case"BOOLEAN":switch(a.operator){case"EQUAL":return a.values&&e===a.values[0];case"NOT_EQUAL":return a.values&&e!==a.values[0]}case"TIME":switch(a.operator){case"BEFORE":case"BEFORE_OR_EQUAL":case"AFTER":case"AFTER_OR_EQUAL":return!1}case"TIME_INTERVAL":switch(a.operator){case"BEFORE":case"BEFORE_OR_EQUAL":case"AFTER":case"AFTER_OR_EQUAL":return!1}default:return!1}}function evaluateExpression(e,a){switch(a.type){case"GROUP":{const r=!("AND"!==a.boolean_operator),s=a.expressions.reduce((r,s)=>"AND"===a.boolean_operator?r&&evaluateExpression(e,s):r||evaluateExpression(e,s),r);return a.negation?!s:s}case"OBJECT":{const r=!("AND"!==a.boolean_operator),s=a.expressions.reduce((r,s)=>Array.isArray(e)?e.some(e=>"AND"===a.boolean_operator?r&&evaluateExpression(e[a.field],s):r||evaluateExpression(e[a.field],s)):"AND"===a.boolean_operator?r&&evaluateExpression(e[a.field],s):r||evaluateExpression(e[a.field],s),r);return a.negation?!s:s}case"FIELD":return Array.isArray(e)?e.some(e=>!!a.comparison&&evalOperator(e[a.field],a.comparison)):!!a.comparison&&evalOperator(e[a.field],a.comparison);default:return!1}}Object.defineProperty(window,"__esModule",{value:!0}),window.mics=window.mics||{},window.mics.evaluateExpression=evaluateExpression,window.mics&&window.mics._setEvaluator&&window.mics._setEvaluator(evaluateExpression);